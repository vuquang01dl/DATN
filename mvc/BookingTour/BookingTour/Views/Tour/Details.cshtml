@model TourDetailModel;
@{
    ViewData["Title"] = "Chi tiết tour ";
    Layout = "_ecomLayout";
}
@section css {
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <style>
        .card-size {
            height: 100%; /* Đảm bảo chiều cao thẻ đều */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .carousel-control-prev, .carousel-control-next {
            width: 5%; /* Độ rộng của nút điều hướng */
        }

        .carousel-control-prev-icon, .carousel-control-next-icon {
            background-color: rgba(0, 0, 0, 0.5); /* Màu nền nút */
            border-radius: 50%; /* Bo tròn */
            width: 30px;
            height: 30px;
        }

    </style>


}
<section class="client_section layout_padding">
    <section class="container">
        <section class="content-header">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a asp-action="Index" asp-controller="Home">Trang Chủ</a>
                    </li>
                    <li class="breadcrumb-item" aria-current="page">
                        <a asp-action="Index" asp-controller="Tour">Tour</a>
                    </li>
                    <li class="breadcrumb-item active">
                        <a>@Model.City</a>
                    </li>
                </ol>
            </nav>
        </section>
        <section class="content-body">
            <div class="col-md-12">
                <h1 class="pageTitle text-center">@Model.TourName</h1>
            </div>
            <div class="row">
                <div class="col-md-10">
                    <img data-u="image" class="rounded-5 mt-2"
                        src="~/assetPrivate/img/tour/@Model.Image" style="max-height:500px; object-fit:cover">
                    <div class="card mt-3">
                        <div class="card-header bg-white">
                            <div class="row p-2">
                                <div class="col-6 d-flex justify-content-center align-items-center">
                                    <strong>Khởi hành:</strong>
                                    <p class="fw-bold ms-1">@Model.City</p>
                                </div>
                                <div class="col-6 d-flex justify-content-center align-items-center">
                                    <strong>Mã Tour:</strong>
                                    <p class="fw-bold ms-1">@Model.TourID</p>
                                </div>
                            </div>
                        </div>

                        <div class="card-body">
                            <h2>Tour Trọn gói bao gồm</h2>
                            <div class="row p-3 g-3">
                                <div class="col-4">
                                    Khách sạn 
                                </div>
                                <div class="col-4">
                                    Bữa ăn
                                </div>
                                <div class="col-4">
                                    Xe tham quan
                                </div>
                                <div class="col-4">
                                    Vé tham quan
                                </div>
                                <div class="col-4">
                                    Hướng dẫn viên
                                </div>
                                <div class="col-4">
                                    Bảo hiểm du lịch
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h2>Những trải nghiệm thú vị trong tour</h2>
                            <p>@Model.Description</p>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h2>Thông tin Nơi ở</h2>
                            <div class="container">
                                <ul class="list-group">
                                    @for (int i = 0; i < Model.Hotels.Count; i++) { <li
                                        class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="card w-100">
                                            <div class="card-header">
                                                <div class="d-flex align-items-center">
                                                    <!-- Hình ảnh -->
                                                    <img src="~/assetPrivate/img/hotel/@Model.Hotels[i].Image"
                                                        alt="" class="img-thumbnail" width="150" height="150"
                                                        style="object-fit: cover;">

                                                    <!-- Thông tin -->
                                                    <div class="ml-3">
                                                        <div class="mb-1 ml-2">Ngày @(i + 1)</div>
                                                        <p class="mb-0">@Model.Hotels[i].Name</p>
                                                    </div>

                                                    <!-- Nút -->
                                                    <button class="btn btn-secondary btn-sm ml-auto"
                                                        data-toggle="collapse" data-target="#collapse-hotel-@(i)">
                                                        <i class="bi bi-three-dots"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Nội dung chi tiết -->
                                            <div class="card-body collapse" id="collapse-hotel-@(i)">
                                                <p class="mt-1">@Model.Hotels[i].Description</p>
                                                    <img src="~/assetPrivate/img/hotel/@Model.Hotels[i].Image"
                                                    alt="" style="object-fit: cover;" class="w-100">
                                            </div>
                                        </div>
                                        </li>

                                        }
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h2>Chương trình tour</h2>
                            <div class="container">
                                <ul class="list-group">
                                    @for (int i = 0; i < Model.Destinations.Count; i++) { <li
                                        class="list-group-item d-flex justify-content-between align-items-center">
                                        <div class="card w-100">
                                            <div class="card-header">
                                                <div class="d-flex align-items-center">
                                                    <!-- Hình ảnh -->
                                                        <img src="~/assetPrivate/img/destination/@Model.Destinations[i].Image"
                                                        alt="" class="img-thumbnail" width="150" height="150"
                                                        style="object-fit: cover;">

                                                    <!-- Thông tin -->
                                                    <div class="ms-3">
                                                        <div class="mb-1 ml-2">Ngày @(i + 1)</div>
                                                        <p class="mb-0">@Model.Destinations[i].Name</p>
                                                    </div>

                                                    <!-- Nút -->
                                                    <button class="btn btn-secondary btn-sm ml-auto"
                                                        data-toggle="collapse" data-target="#collapse-destination-@(i)">
                                                        <i class="bi bi-three-dots"></i>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Nội dung chi tiết -->
                                            <div class="card-body collapse" id="collapse-destination-@(i)">
                                                <p class="mt-1">@Model.Destinations[i].Description</p>
                                                    <img src="~/assetPrivate/img/destination/@Model.Destinations[i].Image"
                                                    alt="" style="object-fit: cover;" class="w-100">
                                            </div>
                                        </div>
                                        </li>

                                        }
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-header">
                            <h4 class="card-title">Lịch khởi hành & giá Tour</h4>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="multi-filter-select" class="display table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>Ngày khởi hành</th>
                                            <th>Ngày Về</th>
                                            <th>Số chỗ còn lại</th>
                                            <th>Giá</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr>
                                            <th>Ngày khởi hành</th>
                                            <th>Ngày Về</th>
                                            <th>Số chỗ còn lại</th>
                                            <th>Giá</th>
                                        </tr>
                                    </tfoot>
                                    <tbody>
                                        @if (Model.TourBookings.Count > 0)
                                        {
                                        @foreach (var tour in Model.TourBookings)
                                        {
                                        <tr>
                                            <th scope="row">@tour.StartDate.ToString("dd/MM/yyyy HH:mm tt")</th>
                                            <th>@tour.EndDate.ToString("dd/MM/yyyy HH:mm tt")</th>
                                            <th>@tour.AvailableSeats</th>
                                            <th><strong class="text-success">@string.Format("{0:N0}₫", tour.Price)</strong></th>
                                        </tr>
                                        }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-3">
                        <div class="card-body">
                            <h2>Đánh giá</h2>
                            <div class="container">
                                <ul class="list-group">
                                    @for (int i = 0; i < Model.Feedbacks.Count; i++) { <li
                                        class="list-group-item feedback-item @(i >= 2 ? " d-none" : "" )">
                                        <!-- Thông tin người đánh giá -->
                                        <div class="d-flex align-items-center mb-3">
                                            <!-- Ảnh đại diện -->
                                                <img src="~/assetPrivate/img/customer/@Model.Feedbacks[i].Customer.Image" alt="Avatar" class="rounded-circle me-3"
                                                width="50" height="50" style="object-fit: cover;">

                                            <!-- Tên và thời gian đánh giá -->
                                            <div class="ml-3 flex-grow-1">
                                                <h6 class="mb-0 fw-bold">@(Model.Feedbacks[i].Customer.Email)</h6>
                                                    <!-- Nội dung Feedback -->
                                                    <p class="mb-2">@Model.Feedbacks[i].Comments</p>
                                            </div>

                                                <!-- Rating -->
                                                <div class="ms-auto">
                                                    <div class="text-warning">
                                                        @for (int j = 0; j < Model.Feedbacks[i].Rating; j++)
                                                        {
                                                            <i class="fas fa-star"></i>
                                                        }
                                                        @for (int j = Model.Feedbacks[i].Rating; j < 5; j++)
                                                        {
                                                            <i class="far fa-star"></i>
                                                        }
                                                    </div>
                                                    <small class="text-muted">
                                                        @Model.Feedbacks[i].CreateAt.ToString("dd/MM/yyyy HH:mm")
                                                    </small>
                                                </div>
                                        </div>

                                        

                                        
                                        </li>
                                        }
                                </ul>

                                <!-- Nút hiển thị thêm -->
                                <div class="text-center mt-3">
                                    <button id="show-more" class="btn btn-primary">Hiển thị thêm</button>
                                    <button id="hide-all" class="btn btn-secondary d-none">Ẩn bớt</button>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="card bg-light border-primary mt-3 sticky-top row">
                        <div class="card-body text-center">
                            <h5 class="card-title">Đặt tour ngay</h5>
                            <a class="btn btn-primary" asp-action="Create" asp-controller="Booking"
                               asp-route-TourID="@Model.TourID" asp-route-UserID="@Model.UserID">Đặt ngay</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                    <div class="col card mt-3">
                        <div class="card-header bg-white">
                            <div class="row p-2">
                                <div class="d-flex flex-row align-items-center">
                                    <h2 class="mb-2">Tours du lịch</h2>
                                    <h2 class="ml-2 mb-2">@Model.City</h2>
                                    <h2 class="ml-2 mb-2">liên quan</h2>
                                </div>
                            </div>
                        </div>
                    <div class="card-body">
                        <div id="tourCarousel" class="carousel slide custom-carousel" data-ride="carousel">
                            <!-- Indicators (tuỳ chọn nếu muốn thêm các nút chấm tròn) -->
                            <ol class="carousel-indicators">
                                @for (int i = 0; i < (Model.AnotherTour.Count + 3) / 4; i++) // Chia thành các slide
                                {
                                    <li data-target="#tourCarousel" data-slide-to="@i" class="@(i == 0 ? "active" : "")"></li>
                                }
                            </ol>

                            <!-- Nội dung carousel -->
                            <div class="carousel-inner">
                                @for (int i = 0; i < Model.AnotherTour.Count; i += 4)
                                {
                                    <div class="carousel-item @(i == 0 ? "active" : "")">
                                        <div class="row">
                                            @for (int j = i; j < i + 4 && j < Model.AnotherTour.Count; j++)
                                            {
                                                <div class="col-4 col-sm-6 col-lg-3 mb-3">
                                                    <a asp-action="Details" asp-controller="Tour" asp-route-TourID="@Model.AnotherTour[j].TourID"
                                                       class="text-decoration-none">
                                                        <div class="card card-size">
                                                            <img src="~/assetPrivate/img/tour/@Model.AnotherTour[j].Image" class="card-img-top" alt="Tour image">
                                                            <div class="card-body">
                                                                <h5 class="card-title">@Model.AnotherTour[j].Title</h5>
                                                                <p class="card-text">@Model.AnotherTour[j].Description</p>
                                                            </div>
                                                            <div class="card-footer">
                                                                <div class="d-flex justify-content-between align-items-center">
                                                                    <span class="invisible">Placeholder</span>
                                                                    <strong class ="text-success">@string.Format("{0:N0}₫", Model.AnotherTour[j].Price)</strong>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>

                            <!-- Nút điều hướng -->
                            <a class="carousel-control-prev custom-prev" href="#tourCarousel" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="carousel-control-next custom-next" href="#tourCarousel" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>

                    </div>
                </div>
        </section>
    </section>
</section>
@section script{
    <script>
        $(document).ready(function () {
            $("#multi-filter-select").DataTable({
                pageLength: 5,
                initComplete: function () {
                    this.api()
                        .columns()
                        .every(function () {
                            var column = this;
                            var select = $(
                                '<select class="form-control"><option value=""></option></select>'
                            )
                                .appendTo($(column.footer()).empty())
                                .on("change", function () {
                                    var val = $.fn.dataTable.util.escapeRegex($(this).val());

                                    column
                                        .search(val ? "^" + val + "$" : "", true, false)
                                        .draw();
                                });

                            column
                                .data()
                                .unique()
                                .sort()
                                .each(function (d, j) {
                                    select.append('<option value="' + d + '">' + d + "</option>");
                                });
                        });
                },
            });



            // Add Row
            $("#add-row").DataTable({
                pageLength: 5,
            });
        });
    </script>
    <script>
        function toggleCardBody(button) {
    // Lấy phần tử `.card-body` tương ứng với nút bấm
    var cardBody = button.closest('.card').querySelector('.card-body');
    
    // Kiểm tra trạng thái hiện tại và thay đổi
    if (cardBody.style.display === "none" || cardBody.style.display === "") {
        cardBody.style.display = "block"; // Hiển thị
    } else {
        cardBody.style.display = "none"; // Ẩn đi
    }
    }

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const showMoreButton = document.getElementById("show-more");
            const hideAllButton = document.getElementById("hide-all");
            const feedbackItems = document.querySelectorAll(".feedback-item");
            let visibleCount = 2; // Số phần tử hiển thị ban đầu

            showMoreButton.addEventListener("click", function () {
                // Hiển thị thêm 5 phần tử
                let hiddenItems = Array.from(feedbackItems).filter(item => item.classList.contains("d-none"));
                for (let i = 0; i < 2 && i < hiddenItems.length; i++) {
                    hiddenItems[i].classList.remove("d-none");
                }

                // Cập nhật số phần tử đã hiển thị
                visibleCount += 2;
        hideAllButton.classList.remove("d-none");

                // Ẩn nút nếu không còn phần tử để hiển thị
                if (visibleCount >= feedbackItems.length) {
                    showMoreButton.style.display = "none";
                }
            });

                hideAllButton.addEventListener("click", function () {
            // Ẩn tất cả feedback ngoài 5 phần tử đầu tiên
            feedbackItems.forEach((item, index) => {
                if (index >= 2) {
                    item.classList.add("d-none");
                }
            });

            // Đặt lại trạng thái ban đầu
            visibleCount = 2;

            // Hiển thị nút "Hiển thị thêm" và ẩn nút "Ẩn lại"
            showMoreButton.style.display = "inline-block";
            hideAllButton.classList.add("d-none");


        });
        });
    </script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
}